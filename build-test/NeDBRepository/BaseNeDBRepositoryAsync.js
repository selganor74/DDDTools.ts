var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
define(["require", "exports", "../DDDTools/Repository/BaseRepositoryAsync", "../DDDTools/Repository/Errors"], function (require, exports, BaseRepositoryAsync_1, Errors_1) {
    "use strict";
    var DbItem = (function () {
        function DbItem(item) {
            this.key = item.getKey().toString();
            this.item = item;
        }
        return DbItem;
    }());
    var BaseNeDBRepositoryAsync = (function (_super) {
        __extends(BaseNeDBRepositoryAsync, _super);
        function BaseNeDBRepositoryAsync(managedType, nedbDatastore) {
            _super.call(this, managedType);
            this.datastore = nedbDatastore;
        }
        BaseNeDBRepositoryAsync.prototype.getByIdImplementation = function (id) {
            var deferred = Q.defer();
            this.datastore.findOne({ key: id.toString() }, function (err, document) {
                if (err) {
                    deferred.reject(err);
                    return;
                }
                if (!document) {
                    var reason = Errors_1.Errors.getErrorInstance(Errors_1.Errors.ItemNotFound, "Item with id " + id.toString() + " was not found.");
                    deferred.reject(reason);
                    return;
                }
                deferred.resolve(document.item);
            });
            return deferred.promise;
        };
        BaseNeDBRepositoryAsync.prototype.doAnInsert = function (toSave, deferred) {
            this.datastore.insert(toSave, function (err, document) {
                if (err) {
                    deferred.reject(err);
                    return;
                }
                deferred.resolve();
            });
        };
        BaseNeDBRepositoryAsync.prototype.doAnUpdate = function (toSave, deferred) {
            this.datastore.update(toSave, function (err, document) {
                if (err) {
                    deferred.reject(err);
                    return;
                }
                deferred.resolve();
            });
        };
        BaseNeDBRepositoryAsync.prototype.saveImplementation = function (item) {
            var _this = this;
            var deferred = Q.defer();
            this.datastore.findOne({ id: item.getKey() }, function (err, document) {
                if (err) {
                    deferred.reject(err);
                    return;
                }
                var toSave = new DbItem(item);
                if (!document) {
                    _this.doAnInsert(toSave, deferred);
                    return;
                }
                _this.doAnUpdate(toSave, deferred);
            });
            return deferred.promise;
        };
        BaseNeDBRepositoryAsync.prototype.deleteImplementation = function (id) {
            var deferred = Q.defer();
            this.datastore.remove({ id: id.toString() }, function (err, document) {
                if (err) {
                    deferred.reject(err);
                    return;
                }
                deferred.resolve();
            });
            return deferred.promise;
        };
        return BaseNeDBRepositoryAsync;
    }(BaseRepositoryAsync_1.BaseRepositoryAsync));
    exports.BaseNeDBRepositoryAsync = BaseNeDBRepositoryAsync;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQmFzZU5lREJSZXBvc2l0b3J5QXN5bmMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvTmVEQlJlcG9zaXRvcnkvQmFzZU5lREJSZXBvc2l0b3J5QXN5bmMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7OztJQXFCSTtRQU9RLGdCQUFhLElBQU87WUFDaEIsSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFLENBQUM7WUFDcEMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDckIsQ0FBQztRQUNMLGFBQUM7SUFBRCxDQUFDLEFBWEwsSUFXSztJQUVMO1FBS1ksMkNBQTJCO1FBSy9CLGlDQUNJLFdBQW1CLEVBQ25CLGFBQTRCO1lBRTVCLGtCQUFNLFdBQVcsQ0FBQyxDQUFDO1lBQ25CLElBQUksQ0FBQyxTQUFTLEdBQUcsYUFBYSxDQUFDO1FBQ25DLENBQUM7UUFFUyx1REFBcUIsR0FBL0IsVUFBZ0MsRUFBTztZQUNuQyxJQUFJLFFBQVEsR0FBRyxDQUFDLENBQUMsS0FBSyxFQUFLLENBQUM7WUFFNUIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQWlCLEVBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxRQUFRLEVBQUUsRUFBQyxFQUFFLFVBQVMsR0FBRyxFQUFFLFFBQVE7Z0JBQy9FLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7b0JBQ04sUUFBUSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztvQkFDckIsTUFBTSxDQUFDO2dCQUNYLENBQUM7Z0JBQ0QsRUFBRSxDQUFBLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO29CQUNYLElBQUksTUFBTSxHQUFHLGVBQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxlQUFNLENBQUMsWUFBWSxFQUFFLGVBQWUsR0FBRyxFQUFFLENBQUMsUUFBUSxFQUFFLEdBQUcsaUJBQWlCLENBQUMsQ0FBQztvQkFDL0csUUFBUSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztvQkFDeEIsTUFBTSxDQUFDO2dCQUNYLENBQUM7Z0JBQ0QsUUFBUSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDcEMsQ0FBQyxDQUFDLENBQUM7WUFFSCxNQUFNLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQztRQUM1QixDQUFDO1FBRU8sNENBQVUsR0FBbEIsVUFBbUIsTUFBdUIsRUFBRSxRQUF3QjtZQUVoRSxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBa0IsTUFBTSxFQUFFLFVBQVMsR0FBRyxFQUFFLFFBQVE7Z0JBQ2pFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7b0JBQ04sUUFBUSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztvQkFDckIsTUFBTSxDQUFDO2dCQUNYLENBQUM7Z0JBQ0QsUUFBUSxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQ3ZCLENBQUMsQ0FBQyxDQUFDO1FBRVAsQ0FBQztRQUVPLDRDQUFVLEdBQWxCLFVBQW1CLE1BQXVCLEVBQUUsUUFBd0I7WUFFaEUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQWtCLE1BQU0sRUFBRSxVQUFTLEdBQUcsRUFBRSxRQUFRO2dCQUNqRSxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO29CQUNOLFFBQVEsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7b0JBQ3JCLE1BQU0sQ0FBQztnQkFDWCxDQUFDO2dCQUNELFFBQVEsQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUN2QixDQUFDLENBQUMsQ0FBQztRQUNQLENBQUM7UUFFUyxvREFBa0IsR0FBNUIsVUFBNkIsSUFBTztZQUFwQyxpQkFrQkM7WUFqQkcsSUFBSSxRQUFRLEdBQUcsQ0FBQyxDQUFDLEtBQUssRUFBTSxDQUFDO1lBRTdCLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLEVBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsRUFBQyxFQUFDLFVBQUMsR0FBRyxFQUFFLFFBQVE7Z0JBQ3JELEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7b0JBQ04sUUFBUSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztvQkFDckIsTUFBTSxDQUFDO2dCQUNYLENBQUM7Z0JBQ0QsSUFBSSxNQUFNLEdBQUcsSUFBSSxNQUFNLENBQVUsSUFBSSxDQUFDLENBQUM7Z0JBQ3ZDLEVBQUUsQ0FBQSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztvQkFFWCxLQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztvQkFDbEMsTUFBTSxDQUFDO2dCQUNYLENBQUM7Z0JBQ0QsS0FBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFDdEMsQ0FBQyxDQUFDLENBQUM7WUFFSCxNQUFNLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQztRQUM1QixDQUFDO1FBRVMsc0RBQW9CLEdBQTlCLFVBQStCLEVBQVE7WUFDbkMsSUFBSSxRQUFRLEdBQUcsQ0FBQyxDQUFDLEtBQUssRUFBTSxDQUFDO1lBRTdCLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLEVBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxRQUFRLEVBQUUsRUFBQyxFQUFDLFVBQUMsR0FBRyxFQUFFLFFBQVE7Z0JBQ3BELEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7b0JBQ04sUUFBUSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztvQkFDckIsTUFBTSxDQUFDO2dCQUNYLENBQUM7Z0JBQ0QsUUFBUSxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQ3ZCLENBQUMsQ0FBQyxDQUFDO1lBRUgsTUFBTSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUM7UUFDNUIsQ0FBQztRQUNMLDhCQUFDO0lBQUQsQ0FBQyxBQTdGTCxDQUtZLHlDQUFtQixHQXdGMUI7SUE3RmlCLCtCQUF1QiwwQkE2RnhDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vLi4vdHlwaW5ncy9icm93c2VyLmQudHNcIiAvPlxyXG5cclxuaW1wb3J0IE5lREJEYXRhU3RvcmUgPSByZXF1aXJlKCBcIm5lZGJcIiApO1xyXG5cclxuaW1wb3J0IHtCYXNlQWdncmVnYXRlUm9vdH0gZnJvbSBcIi4uL0RERFRvb2xzL0FnZ3JlZ2F0ZS9CYXNlQWdncmVnYXRlUm9vdFwiO1xyXG5pbXBvcnQge0lLZXlWYWx1ZU9iamVjdH0gZnJvbSBcIi4uL0RERFRvb2xzL0VudGl0eS9JS2V5VmFsdWVPYmplY3RcIjtcclxuaW1wb3J0IHtJUmVwb3NpdG9yeUFzeW5jfSBmcm9tIFwiLi4vREREVG9vbHMvUmVwb3NpdG9yeS9JUmVwb3NpdG9yeUFzeW5jXCI7XHJcbmltcG9ydCB7QmFzZVJlcG9zaXRvcnlBc3luY30gZnJvbSBcIi4uL0RERFRvb2xzL1JlcG9zaXRvcnkvQmFzZVJlcG9zaXRvcnlBc3luY1wiO1xyXG5pbXBvcnQge0Vycm9yc30gZnJvbSBcIi4uL0RERFRvb2xzL1JlcG9zaXRvcnkvRXJyb3JzXCI7XHJcblxyXG5pbXBvcnQgSVByb21pc2UgPSBRLklQcm9taXNlO1xyXG5cclxuLyoqXHJcbiAqIFJlcG9zaXRvcnkgaW1wbGVtZW50YXRpb24gZm9yIHRoZSBOZURCIGRhdGFiYXNlLlxyXG4gKi9cclxuLy8gbmFtZXNwYWNlIFJlcG9zaXRvcnkuTmVEQkltcGxlbWVudGF0aW9uIHtcclxuICAgIGRlY2xhcmUgdmFyIE5lZGIgOiB0eXBlb2YgTmVEQkRhdGFTdG9yZTtcclxuICAgIFxyXG4gICAgLyoqXHJcbiAgICAgKiBUaGlzIGlzIHRoZSBvYmplY3QgdGhhdCBpcyBlZmZlY3RpdmVseSB3cml0dGVuIHRvIGRpc2tcclxuICAgICAqL1xyXG4gICAgY2xhc3MgRGJJdGVtPFxyXG4gICAgICAgIFQgZXh0ZW5kcyBCYXNlQWdncmVnYXRlUm9vdDxULCBUS2V5PiwgXHJcbiAgICAgICAgVEtleSBleHRlbmRzIElLZXlWYWx1ZU9iamVjdDxUS2V5PlxyXG4gICAgICAgID4ge1xyXG4gICAgICAgICAgICBrZXk6IHN0cmluZztcclxuICAgICAgICAgICAgaXRlbTogVDtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0cnVjdG9yKCBpdGVtOiBUKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmtleSA9IGl0ZW0uZ2V0S2V5KCkudG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaXRlbSA9IGl0ZW07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICBcclxuICAgIGV4cG9ydCBhYnN0cmFjdCBjbGFzcyBCYXNlTmVEQlJlcG9zaXRvcnlBc3luY1xyXG4gICAgICAgIDxcclxuICAgICAgICAgICAgVCBleHRlbmRzIEJhc2VBZ2dyZWdhdGVSb290PFQsIFRLZXk+LFxyXG4gICAgICAgICAgICBUS2V5IGV4dGVuZHMgSUtleVZhbHVlT2JqZWN0PFRLZXk+XHJcbiAgICAgICAgPiBcclxuICAgICAgICBleHRlbmRzIEJhc2VSZXBvc2l0b3J5QXN5bmM8VCxUS2V5PlxyXG4gICAgICAgIGltcGxlbWVudHMgSVJlcG9zaXRvcnlBc3luYzxULFRLZXk+IHsgXHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgcHJpdmF0ZSBkYXRhc3RvcmU6IE5lREJEYXRhU3RvcmU7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICAgICAgICAgIG1hbmFnZWRUeXBlOiBzdHJpbmcsXHJcbiAgICAgICAgICAgICAgICBuZWRiRGF0YXN0b3JlOiBOZURCRGF0YVN0b3JlXHJcbiAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgICAgc3VwZXIobWFuYWdlZFR5cGUpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhc3RvcmUgPSBuZWRiRGF0YXN0b3JlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBwcm90ZWN0ZWQgZ2V0QnlJZEltcGxlbWVudGF0aW9uKGlkOlRLZXkpOiBJUHJvbWlzZTxUPiB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSBRLmRlZmVyPFQ+KCk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHRoaXMuZGF0YXN0b3JlLmZpbmRPbmU8RGJJdGVtPFQsVEtleT4+KHtrZXk6IGlkLnRvU3RyaW5nKCl9LCBmdW5jdGlvbihlcnIsIGRvY3VtZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZighZG9jdW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlYXNvbiA9IEVycm9ycy5nZXRFcnJvckluc3RhbmNlKEVycm9ycy5JdGVtTm90Rm91bmQsIFwiSXRlbSB3aXRoIGlkIFwiICsgaWQudG9TdHJpbmcoKSArIFwiIHdhcyBub3QgZm91bmQuXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QocmVhc29uKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRvY3VtZW50Lml0ZW0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBwcml2YXRlIGRvQW5JbnNlcnQodG9TYXZlOiBEYkl0ZW08VCwgVEtleT4sIGRlZmVycmVkOiBRLkRlZmVycmVkPHt9Pikge1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGFzdG9yZS5pbnNlcnQ8RGJJdGVtPFQsIFRLZXk+Pih0b1NhdmUsIGZ1bmN0aW9uKGVyciwgZG9jdW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHByaXZhdGUgZG9BblVwZGF0ZSh0b1NhdmU6IERiSXRlbTxULCBUS2V5PiwgZGVmZXJyZWQ6IFEuRGVmZXJyZWQ8e30+KSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhc3RvcmUudXBkYXRlPERiSXRlbTxULCBUS2V5Pj4odG9TYXZlLCBmdW5jdGlvbihlcnIsIGRvY3VtZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcHJvdGVjdGVkIHNhdmVJbXBsZW1lbnRhdGlvbihpdGVtOiBUKTogSVByb21pc2U8e30+IHtcclxuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9IFEuZGVmZXI8e30+KCk7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhc3RvcmUuZmluZE9uZSh7aWQ6IGl0ZW0uZ2V0S2V5KCl9LChlcnIsIGRvY3VtZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB2YXIgdG9TYXZlID0gbmV3IERiSXRlbTxULCBUS2V5PihpdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICBpZighZG9jdW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRG9jdW1lbnQgZG9lcyBub3QgZXhpc3QgaW4gY29sbGVjdGlvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRvQW5JbnNlcnQodG9TYXZlLCBkZWZlcnJlZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kb0FuVXBkYXRlKHRvU2F2ZSwgZGVmZXJyZWQpOyAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHByb3RlY3RlZCBkZWxldGVJbXBsZW1lbnRhdGlvbihpZDogVEtleSk6IElQcm9taXNlPHt9PiB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSBRLmRlZmVyPHt9PigpO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuZGF0YXN0b3JlLnJlbW92ZSh7aWQ6IGlkLnRvU3RyaW5nKCl9LChlcnIsIGRvY3VtZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7ICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuLy8gfSJdfQ==